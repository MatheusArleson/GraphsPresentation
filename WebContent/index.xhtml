<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<h:head>

		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Graphs</title>

		<style type="text/css">
			.ui-widget {
				font-size: 12px !important;
			}
		</style>
		
		<!-- GRAPH DRAWING LIB -->
		<h:outputScript library="js" name="cytoscape.js"/>
		<h:outputScript library="js" name="dagre.js"/>
		<h:outputScript library="js" name="cytoscape-dagre.js"/>
		<h:outputScript library="js" name="cytoscape_empty_render.js"/>
		
		<!-- INITIALIZATION OF EMTY CONTAINER -->
		<h:outputScript>
			$( document ).ready(function() {
				initCy();
			});
			
			$( window ).resize(function() {
				redraw();
			});
		
			function showLoading(){
				PF('loading').show();
			}
			
			function hideLoading(){
				PF('loading').hide();
			}
			
			function showUploadDialog(){
				PF('uploadFileDialog').show();
			}
			
			function hideUploadDialog(){
				PF('uploadFileDialog').hide();
			}
		</h:outputScript>
		
	</h:head>

	<h:body>
		
		<h:form id="mainForm">
		
			<p:messages id="messages" 
						showDetail="false" 
						autoUpdate="true" 
						closable="true">
			</p:messages>
		
			<div id="dataDiv" class="ui-fluid">
		
				<p:panelGrid id="configGrid" layout="grid" columns="3"
							 columnClasses="ui-grid-col-4" styleClass="ui-panelgrid-blank"
							 style="border:none;">
		
					<p:fieldset legend="Graph Properties">
						<p:panelGrid columns="2">
						
							<p:selectBooleanCheckbox id="checkDirectedGraph"
													 label="Directed Graph"
													 value="#{graphPresentationBean.graphProperties.directedGraph}">
								<p:ajax event="change" process="@this"/>
							</p:selectBooleanCheckbox>
							<p:outputLabel for="checkDirectedGraph" value="Directed"/>
							
							<p:selectBooleanCheckbox id="checkWeightedGraph"
													 label="Weighted Graph"
													 value="#{graphPresentationBean.graphProperties.weightedGraph}">
								<p:ajax event="change" process="@this"/>
							</p:selectBooleanCheckbox>
							<p:outputLabel for="checkWeightedGraph" value="Weighted"/>
							
							<p:selectBooleanCheckbox id="checkLoopsGraph"
													 label="Loops allowed in Graph"
													 value="#{graphPresentationBean.graphProperties.loopsAllowed}"
													 disabled="true">
								<p:ajax event="change" process="@this"/>
							</p:selectBooleanCheckbox>
							<p:outputLabel for="checkLoopsGraph" value="Loops Allowed"/>
							
							<p:selectBooleanCheckbox id="checkMultipleEdgesGraph"
													 label="Multiple Edges Allowed in Graph"
													 value="#{graphPresentationBean.graphProperties.multipleEdgesAllowed}"
													 disabled="true">
								<p:ajax event="change" process="@this"/>
							</p:selectBooleanCheckbox>
							<p:outputLabel for="checkMultipleEdgesGraph" value="Multiple Edges"/>
						</p:panelGrid>
						
					</p:fieldset>
		
					<p:fieldset legend="Graph Representation Delimiters">
						<p:outputPanel id="delimitMainPanel">
						
							<p:outputPanel id="delimitersPanel">
								<p:panelGrid columns="2">
									
									<p:outputLabel value="Start:"/>
									<p:inputText id="delAdjMatrixStart" label="Matrix Start Delimiter"
												 value="#{graphPresentationBean.representationStartDelimiter}"
												 required="true">
										<p:ajax event="keyup" process="@this"/>
										<p:ajax event="blur" process="@this"/>
									</p:inputText>
									
									<p:outputLabel value="End:"/>
									<p:inputText id="delAdjMatrixEnd" label="Matrix End Delimiter"
												 value="#{graphPresentationBean.representationEndDelimiter}"
												 required="true">
										<p:ajax event="keyup" process="@this"/>
										<p:ajax event="blur" process="@this"/>
									</p:inputText>
									
									<p:outputLabel value="Row:"/>
									<p:inputText id="delAdjMatrixRow" label="Matrix Row Delimiter"
												 value="#{graphPresentationBean.representationRowSeparator}"
												 required="false">
										<p:ajax event="keyup" process="@this"/>
										<p:ajax event="blur" process="@this"/>
									</p:inputText>
									
									<p:outputLabel value="Row Elements:"/>
									<p:inputText id="delAjdMatrixRowElem" label="Matrix Row Elements Delimiter"
												 value="#{graphPresentationBean.representationRowElementsSeparator}"
												 required="true">
										<p:ajax event="keyup" process="@this"/>
										<p:ajax event="blur" process="@this"/>
									</p:inputText>
									
								</p:panelGrid>
							</p:outputPanel>
							
						</p:outputPanel>
					</p:fieldset>
		
					<p:fieldset legend="Graph Representation">
						<h:panelGroup id="representationGroup">
						
							<p:outputLabel for="somRepMode" value="Type:"/>
							<p:selectOneMenu id="somRepMode" value="#{graphPresentationBean.graphRepresentationMode}">
								<f:selectItems	value="#{graphPresentationBean.graphRepresentationModes}"
												var="repMode" 
												itemLabel="#{repMode.label}"
												itemValue="#{repMode}">
								</f:selectItems>
								
								<p:ajax event="itemSelect"
										listener="#{graphPresentationBean.processChangeGraphRepresentationMode}"
										process="@this somRepMode"
										update="graphRepresentationText">
								</p:ajax>
								
							</p:selectOneMenu>
							
							<p:outputLabel for="fileGraphRepresentationBtn" value="File:"/>
							<p:commandButton 	id="fileGraphRepresentationBtn"
												value="Choose file..."
												actionListener="#{graphPresentationBean.clearFileUpload()}"
												process="@this"
												update="@this"
												onstart="showLoading();"
												oncomplete="hideLoading();showUploadDialog();">
							</p:commandButton>
							
							<p:outputLabel for="graphRepresentationText" value="Text:"/>
							<p:inputTextarea id="graphRepresentationText"
											 value="#{graphPresentationBean.textRepresentation}"
											 autoResize="true"
											 required="false">
							</p:inputTextarea>
							
						</h:panelGroup>
					</p:fieldset>
		
				</p:panelGrid>
		
			</div>
			
			<div id="controlsDiv" class="ui-fluid">
				
				<p:panelGrid id="controlsGrid" layout="grid" columns="3"
							 columnClasses="ui-grid-col-4" styleClass="ui-panelgrid-blank"
							 style="border:none;">
					
					<p:commandButton id="resetBtn" 
									 value="Reset Graph"
									 type="button"
									 process="@this"
									 update="@none"
									 onclick="redraw();">
					</p:commandButton>
					
					<p:commandButton id="clearBtn" 
									 value="Clear"
									 process="@this"
									 update="mainForm"
									 actionListener="#{graphPresentationBean.clearGraph}"
									 onstart="showLoading();"
									 oncomplete="hideLoading();">
					</p:commandButton>
					
					<p:commandButton id="processBtn" 
									 value="Process Graph"
									 process="@form"
									 update="@none"
									 actionListener="#{graphPresentationBean.processGraph}"
									 onstart="showLoading();"
									 oncomplete="hideLoading();">
					</p:commandButton>					
				</p:panelGrid>
			
			</div>
			
		</h:form>
		
		<h:form id="graphCanvasForm">
			<div id="cy" class="ui-fluid" style="border: solid 1px; height: 300px;"/>
		</h:form>
		
		<h:form id="loadingDialogForm">
			<p:dialog 	id="loadingDialog" widgetVar="loading" header="Loading..."
						width="75px" height="30px" 
						modal="true" responsive="true" position="center"
						resizable="false" draggable="false"
						minimizable="false" maximizable="false"
						closable="false" closeOnEscape="false"
						showEffect="clip" hideEffect="clip">
				<h:panelGroup id="loadindPanel">
					<div align="center">
						<h:graphicImage library="images" name="loading.gif"/>
					</div>
				</h:panelGroup>
			</p:dialog>
		</h:form>
		
		<h:form id="uploadFileDialogForm" enctype="multipart/form-data">
			<p:dialog 	id="uploadFileDialog" widgetVar="uploadFileDialog" header="Upload File"
						modal="true" responsive="true" 
						resizable="false" draggable="false"
						minimizable="false" maximizable="false"
						closable="true" closeOnEscape="true"
						showEffect="clip" hideEffect="clip">
				<h:panelGroup id="uploadFilePanel">

					<p:fileUpload	mode="advanced" multiple="false" auto="false"
									value="#{graphPresentationBean.uploadedFile}" 
									fileUploadListener="#{graphPresentationBean.fileUploadListener}"
									update=":mainForm:graphRepresentationText"
									label="Choose File" uploadLabel="Send" cancelLabel="Clear"
									allowTypes="/(\.)(txt)$/" accept=".txt"
									invalidFileMessage="Only text files are allowed. (.txt)"
									sizeLimit="1024" invalidSizeMessage="File exceed file size limit."
									onstart="showLoading();"
									oncomplete="hideLoading();">
					</p:fileUpload>
				
				</h:panelGroup>
			</p:dialog>
		</h:form>
		
	</h:body>
	
</html>